# Automatically generated on 2021-09-14 UTC from https://codemagic.io/app/6123f3a1cfba6df57ec91479/settings
# Note that this configuration is not an exact match to UI settings. Review and adjust as necessary.

workflows:
  default-workflow:
    name: YAML Workflow
    max_build_duration: 45
    environment:
      groups:
        - google_play
        - api_key
      vars:
        FCI_KEYSTORE_PATH: /tmp/keystore.keystore
        FCI_KEYSTORE: Encrypted(Z0FBQUFBQmhRT2hlZXFSX1lqRi00Rkwxd3Q1Y1czenQyVXRmSmNpRVNCcGFLMWdxcDBTbW40d2xkODlBVTh3U1R2N2pBemZTU1FwLXRDQmVBT0NMdHJ6THBkMXNzWFFLOUVweHFaZXRORjY0YUlja0VlNmlrd3dMbTE4QVBlUEtFSmc5VHRta2p2Q3NPaVZsdXd4aTQzZGMyRDQwbU9KRGVMUWVzaE4tYVEzdTE4ZjFUMWxKSkhNMS04N3F3YXJQY1lybVktMVlkMDhrN0std3ZWQ3dxSGJGQUc5U00xRHRNRlczYnJ0MWpoLWl5UHlZODczQ3ZPaHdkVDRzRzFZMk84bFc0Mm8yM2xkN054U1k1N1UxaXdKd19LNE9FeFhiXzJrMlEzNW96NjlTdEtjQXkydGx0TDJ0S0UtVGdGUjktN3BiMlI0R09ERUhscGoyUEd1bHJ2aDZXOFYyMW82NXdqMzdlTWZQZ3ZGUDhMRk9FeEhmY3lJU1V1YWQ0T0cwSXNsYUFVUUpxQXdvWEpsNmtmWFd1QW5yOVIxejVlSXlZYzNhNlBsVFlKWWI2SFZjWm4tWXBPVTU1UVgtZC10RUtQUXJTZjlEa0VLYmR2emxvZ3dKamlkUkxwZGFTR2kwcVM4aFpEdEotN1Q1Z3g5YndsbUpBcE1mUUQ4UFExWUREX3h2Tk5yazRLNGpmaEdBdjBYSmU2ZlNXTmxhcTd5X21nazVVTFZBTHBLUDJDR1FMM3JPOVBDVXoyanczNGNBV1RvbmZ5eTdjMUJpc0VnMXBNdUkyTTRYLWphRkVSYnljVC13b1g1WVc2N0JKby1veVVQWGhtZ19tMlV4UWJGbVBBYXFsamZwSURBV1g0T3puei0wOFYybVNTb3VUUk43RUNrNzhLTDFvOS1JS2RCNzJDeXNSbEFHNlZuRkhpVGtFaGtkX1NKWXRsVlVGdENaYVdPSnNfVzNEZllTbU1ZVEpHTXdCcFItMzlVQlpwc0NQWWdjWGhESkJUZnJaZndkUm5OSm9WWlpFMmtrNnJKemVZWHdKTFpZY2h6Z3hmT0lOd0ZWWk1lOTVseEdjYktDMWhZZGI1eVNEN2JfeFBOYlNISHo1NjZ0anFiMWhnUHB3MmN5M0c4Yy1DTDlKeVdYRUVVOFc0UUxtd0QwQzhHUDd0VXg5VkhCYThOUUo2dk5INU0tdjlnSTlKSzlZcTdzYjhIbHpickdQVVlQSkl4ejFhVnNCR1BsdW1JcUU3MXpvbGZvN1hLc2wzZ1l5MEFmS2djYkRBWnl6SlU3RW96Rm5tNlZud2FwekFubjgtWHg1ODAwQTlseUxMSlp4c1VPdkJTOVo2SEZKYmxlMGtZc25hR3NTVG1DQVlCZFRwWkNqcDFwakN2MV9sSmEtRk1Zd2dVVUNjdzVPUzZ3QnMtUEQtV1F4M0hFdFpyQXJNMkpTdWZjMFRJQW5OYmN3X0NYT3pTX1Y3VWRWeGZWRkx4cHRqaDFRNXVkSVFCbWI3NExkYnRvdlZxdlhLNVFFTm1ERWYyMHhtaFhWVVBETlJFOWduZmRZQ1N2dzRhVjBKdnVNNDlkTFhzdGdNWS1yb1c0VDUwQTRrM2lJc3FXRk51a1ZCaU1YeW9nT3l0ZklKS3V3MUZ0QndPRmpvYkRDZEZQZlE3LU9GOG1Vb2dBamZhQjhQY2lVeFE4V1JRazJnQ1FoWkFHTXNIN1dRZnhvdEJjY2F6NXFobDZSbzNJWEotMmFOaDNNdzVCMTZyenZJUVQ4OWJWbHljbnRjdG5rYjJyWXRzWVh5MjU5cE9tbnZpSGVjRXMxbDhidVlZOHFTUnFMNTlRcXRUbUNTMVBvMGxXY2ZFODEwN1ZXenduMGJNMVNhbGhYSlc0dGE1TklTM0dkb1kzTWVibUh5UDNCaHVBU1NLZVd4cHJYTG4zWjVwbXp0cG9feDVpSHMxcHhuSnRhODVkSE9lVnVtc3Rrc0t5MjNRSkp6QWdnMXBiVVdJYzZkVkhsV0s5UmdYZnNpcVlWbFpLUXAtZmxyM0wxTG9RUzV1SnFzaUx4UnJ4N19yN1IxQ2NvaGZTYVhsSXpwTjVveGJLQ3htM1QyOHF0RnRPa0pIV1VIaElpT0V2VEdRaGZRaUR5R3ZsQktKN2pDSWpTdS01NURNZ09kQU5RZnNjcVNtaVUyMW5xYlBsOWRXQXJTbjlUV25KSkpob2p2ZW14aEVCNHlSSXViSEF1WkZ6RkI3ZG5hQlZSdHRLUUJPWG55akpCa2VJQWRGZEdqVHE2Z0pRbWtDVFRYeDNGVW0yNXZWMkxFWncwd0kzRkdCdy1PMHpVd21vRGZGdWU1MmZZaXZxdDdzYjF6Wnh4TWtpbnlFVFZPTHZuZFJZM1ZWcDdQMDFMV295X09udHRqb01lV0diSTdmVE9BOWhXaEtfNnMxUEl0eXNVWXNsYVRBNWc5VW9ZSS1KM3BKWV9xM3h1eS0xVThKVW1UMER6S1VIMEtGdjhVUnJzc1dRc1ZscEtVWWp4NG1IYVhqRndkTGJDNk9VMURnRDJmMGw4MGNLVzVpZ2NYQW92YXZPd3A4UVRBMGw5aGJBYlBVN19aQWF2bGxJZ3dHUTJQMGNRMUoyWWpTdjV4a193MHZSQ3hfTEsyTjNrck82SXBWM3AzMEl0WHkwdUl1d3FSeFhVS2U4SmRxalFJRzdVaG1GQjhJOHhQQWI4a1hxSWVZR2psdTBZTlJJZDgtVVdMWjVYYnlQRW1sQ3RrbnpPMmlWVW1WTjRBbnNENDdLWWxFWlNCaWkwbGIxbGEzSjQwQ0VwX1pRcjZFSDJXcGNWTENIQkRGWWowRVdkVW1lU1ZUTGwzOG1iQU44TjUwQzgyam1rbmV3REZxSDFsRHQyZjNZRUxBNE04R1FaeURQSmlZZG9xT2tkUWVwYi0tX2ZsU1EyQkZGb1RrSjZTZXB0MDNlSGNtZEc5bWt6QzV4RmZ3VjRkQWVFNWxlbGxVNnp3YVlwb241YW5yb1RiSGlCdmZJOVBGN3BvVEVzWEVHVmEySVFLNm5WaXhTYy1PTkI3eFRCV05aUENVdlZ2U3lVS2hvV0JFRFBZdXJJZzVpVWhYMl80aTFUUi13a3lVLXRBTFBLWmxGVDEzUW5Jd25SbGpXYzRteEt2d3FfNVc4VlJIdkcwMDRrdFdwMzQ0VUtFV2wydDJpVUZsYXFDLW9WUkFtN3RzdEtSN0p2MkxvTnY2MjN4S1daZGlrb1Q4NG1GMEFLUFpjRG5heXVXQTJtUVdlejFYWkR2R1NXdXVSS1BKbDZJVHV6cnZaU3VsVkNSRXRZbzR5a0wxUUJvcVBfeDlCZE83aXpWeXQwdnRzMF9aWHotNE1Jdy0xNnBpQnA4RWRjRG1paW9qeHVVRkRXbjhOeHhsejllRkl2YXZ0a3dCNlFJbmNNT1ZkMERxdXBfRE9EYlBKbE5aYUppZ3Q1dDBmaXVrUk5MTjFkWk5MRHE2OUZZVHd6ZTBBZFRtWjRxYk1yeEIzYlhnWHR4UUJsVDltNlk4d0VmRGsyUkdlODF4UDhrRWJEek1WUnFIcmNvLUJRYjd2LVlzc3BvYldpOEZkX0dwb3F5VHppUkl4ZkU0M29US01kZFlabmpvbGpkenFfNm1sblRvN0tQWTVBNno2M3VUdFYxUG4zaTE4LWs1Rm1LX0NGV0RaUndTSUhERTd1aUo0MGpxRndaY05JY3Z2Q2N3OGp1RWJQeTdGTWRnT0NTeTJCQ0dPWVp4QVhOeGd1LXFxV2oyT0FKcUl6elZuVk9LMXFlS2NoZVFkWDMwRFpRemhEMzlzUV9jeDkzR1NReUQ2RWtsUjBnVDRYM1NlUTZnTG14VmtKbjc1Z3I2dGhsUU01NnIwTDdRM3RVRlJUM19aY0dpWFhTSUQtdVFiZFR3dGdUM0YxS1I5RFhnUWM0YlhrOG1LR19kYXZ2ZWxkaGw5ZFJoaS1WN0tjN09XMy1QRzctMjBPLXF0NWZwdldGUkhEb2pHRGxnaDIyLVdzMXFlM3NBNkxpVHBqZUVWbXhRRzBfN3RMSDE1VDhjbE5uUjdtZFR3NXNNZGFnejNQcDdmQWUtaVBRRUkxSmJhZldzWENkdTZBZ2gzcE5QcjZmREZNWTB0bDktaEo5UXhUdXIzZ0VERXRYNHNHTTVDRWlmSUJZdWJGVU1ubEpZcFhtbnNqRV8xYjh4bzNOYkxQTDlPLVd0ekhqRmlHd3MxNE1DVXZmeVRPckFsc2lZZ0RTVG5Uejc0d0kxRXBQYmxaZW02NTN1WjNhRFpXVjVWZ1Y1eWtwWVNEc2U5by1pQ0MwSGE0RVMyanA3NkZxMzRsME1EbzFnbzg3Rm9DUDQ5d2Nzbm9uT2x3eFkzdDZQRXVTaVJOWHJfc0Q5Qm5WZFZxQnlLeDRxdHRyaXFaY2lJeXVRTmFrSlNCOUk1S045cWx5cmpFbmNUMmR2dDQ3cUZCMDZJWGtaT0NIMXZnOW93SGJqYnJ1bV9XT2xIODF1bkZlRzI5aWNmSmRlQS1qVEZfUk5ZWHRoaWZXVnEtV1BIckxCeTJPZUtrZGE4NnRqZ0EtcklRSlZNVk1tLW9oRmx4UDRZQkJKTzk4dnBvNmlDZ3lyVU0wRENoaDZFOGljSjUtNm1RaXV0N3NxN3doMDNMMjN5Wk1hSTlQa2EtMmdMSkVvZEVQUWhXY3RRSkVTa2pxeEtlQmdzUW54ckU5S2tjQVJNclIyRjJFR21sV3lTNGN2TUl4eHNvX3JlM0pvMXZTajZQd2dnWk9hSlVBTTJyMXFGdi1zOW5Bd3RacWgxMDZtWHZDa1R6cWFVUTZ1MVNOQ3lDUGxNRFJUMFhpdUlWN3NNUGZmSVBXVGhKaEp3anpJZ0cxdTBZUmJrTUJyaEg3dFJFaGNEeUJ2NFd4TWpVZ2Y2TlJzd3lsWHdGU1RPWmVYWkZqd3FfLU5zdUdNbXhQbm02XzRTZEI1ZGczdmNWQU5LQ213TUkweHFPVXAxZW9nSmJ0dkU0aElJV2dndXBfMnlkT2tLMzk4NU82dy1yMS1vSmhNNWI0YjVOYUkzSnlmc2hYckYyUXN6b0pvS3dJMWxIQjhMRHhGOVd0M0d5b0xmZUNNZ1JXNzIxTHhtbzRLTlI0eTFDVGpKdjYtV2lXSG11c1NjZGlVOVVLLVRvSzhTTFI4cUsyQTZoUF8wU1FJd3ZITU9FaEFjYWUtVDViSXRSdzNVQ3Eyamh3VDVGQ3VxM2FlZmZQTTU1RjBSQVZDVGNuVlRjd0JQVTI5emtJSG9TbFBTTDZGV0JBQ2JMckhQUGttVHQyb2dPVVVNd0FEd2NBS0Y5ak4yQ3ZMYkhUMF9QeGRLdEV2aEVVWmN4dGJLeFR0bk1vY0pEYzVSR1FCMUtHUkMyX1kzeHRxWGJaM1N3cnNZby1DSVFmYXRVOXY4UzUwTVljMD0=)
        FCI_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmhRT2hlQ0NDcTRoM2szY2E1TGJub1g0V2tVRkN4MlpZQlE1d0YtaTFiSTBnbkFBak9xQ09vbjRHRWpIOWJOTWFmSDlBVjZFcHdERmlKMnlnLVVoRjRNM1V4N3c9PQ==)
        FCI_KEY_PASSWORD: Encrypted(Z0FBQUFBQmhRT2hlT0Z4LURQWG90Wk02SkdtY0h5U0NDODJPR3d0bnVTNFJzanZPdVBKNEczLWRUN1J1a1R4WUlTSmh0RFVydUpudWE4Q2k0dXVHZF8xb2JCVWN3c3pwRUE9PQ==)
        FCI_KEY_ALIAS: Encrypted(Z0FBQUFBQmhRT2hlckRYemJZcmhzOGNraUloVy1zakFodEktUWVVMVcwa2V4aGlDUGJ3ZFZfeERxaW0yYUhvUVk1YVJRbzVyN1dYWDg0eE5KX2dPaWZ5OHFDTUU5eW1LVEE9PQ==)
        PACKAGE_NAME: "com.example.movie_app"
        GOOGLE_PLAY_TRACK: "production"
        API_KEY: $API_KEY
      flutter: stable
      xcode: latest
      cocoapods: default
    scripts:
      - |
        # set up key.properties
        echo $FCI_KEYSTORE | base64 --decode > $FCI_KEYSTORE_PATH
        cat >> "$FCI_BUILD_DIR/android/key.properties" <<EOF
        storePassword=$FCI_KEYSTORE_PASSWORD
        keyPassword=$FCI_KEY_PASSWORD
        keyAlias=$FCI_KEY_ALIAS
        storeFile=/tmp/keystore.keystore
        EOF
      - |
        # set up local properties
        echo "flutter.sdk=$HOME/programs/flutter" > "$FCI_BUILD_DIR/android/local.properties"
      - flutter packages pub get
      - |
        #!/bin/sh
        set -ex
      - |
        mkdir assets
        echo "API_KEY=$API_KEY" >> assets/.env
      - cd . && flutter build appbundle --release --build-name=1.0.0 --build-number=$(($(google-play get-latest-build-number --package-name "$PACKAGE_NAME" --tracks="$GOOGLE_PLAY_TRACK") + 51)) --verbose
    artifacts:
      - build/**/outputs/apk/**/*.apk
      - build/**/outputs/bundle/**/*.aab
      - build/**/outputs/**/mapping.txt
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - justin.moretto@stack-labs.com
      google_play:
        credentials: $GCLOUD_SERVICE_ACCOUNT_CREDENTIALS
        track: $GOOGLE_PLAY_TRACK
        in_app_update_priority: 0
